import { useEffect, useState } from "react";

import { useLocation, useNavigate } from "react-router-dom";

import api from "../../api/api";
import styles from "./NavBar.module.css";

function ActIcon(props) {
  return (
    <svg width="28" height="29" viewBox="0 0 28 29" fill="none" {...props}>
      <path
        d="M14 28.3147C12.1607 28.3198 10.339 27.9559 8.63967 27.2442C6.94034 26.5325 5.39676 25.4877 4.09965 24.169C2.79557 22.8573 1.76241 21.2964 1.05864 19.5779C0.354879 17.8595 -0.00512035 16.0173 5.50178e-05 14.1574C-0.00495471 12.2974 0.354889 10.4552 1.05864 8.73679C1.7624 7.01838 2.79571 5.4575 4.09965 4.14574C5.39646 2.82664 6.9393 1.78127 8.6387 1.06957C10.3381 0.357865 12.1606 -0.00561506 14 6.55696e-05C15.8393 -0.00516797 17.661 0.358878 19.3603 1.07055C21.0597 1.78223 22.6033 2.827 23.9004 4.14574C25.204 5.45773 26.2376 7.01843 26.9414 8.73679C27.6451 10.4551 28.0046 12.2975 28 14.1574C28.0047 16.0173 27.6451 17.8596 26.9414 19.5779C26.2376 21.2963 25.2041 22.8571 23.9004 24.169C22.603 25.4874 21.0596 26.5325 19.3603 27.2442C17.6611 27.9558 15.8392 28.3195 14 28.3147ZM6.07034 17.6602C6.74375 19.2194 7.852 20.5461 9.25979 21.478C10.6676 22.4098 12.3135 22.9067 13.9961 22.9069C14.2261 22.9069 14.4092 22.9003 14.5732 22.8872C16.3494 22.7638 18.0451 22.091 19.4306 20.9605C20.8162 19.83 21.8246 18.2964 22.3193 16.567L20.0478 15.1074C19.4688 14.7363 18.7978 14.5387 18.1123 14.5386C17.3939 14.5376 16.6911 14.7537 16.0947 15.1587L12.0225 17.9228C11.2577 18.4482 10.3533 18.7283 9.42873 18.7267C8.7779 18.7281 8.13447 18.5908 7.54007 18.3228L6.07034 17.6602ZM14 5.40386C12.6819 5.40938 11.3819 5.71693 10.1983 6.3035C9.01459 6.89008 7.978 7.74103 7.16604 8.7911C6.35298 9.84259 5.79048 11.0691 5.52152 12.3759C5.25256 13.6826 5.28458 15.0338 5.61527 16.326C5.65826 16.3329 5.70024 16.3453 5.74027 16.3625L7.96389 17.359C8.42481 17.5699 8.92476 17.6793 9.43068 17.6789C10.149 17.6785 10.8513 17.4607 11.4463 17.0538L15.5146 14.2887C16.2826 13.7646 17.1888 13.4853 18.1152 13.4868C19.0009 13.4853 19.8685 13.741 20.6152 14.2225L22.5634 15.4747C22.7527 14.2282 22.672 12.955 22.3281 11.7428C21.9842 10.5306 21.3851 9.40887 20.5713 8.45337C19.7585 7.49566 18.7505 6.7271 17.6162 6.2008C16.4819 5.6745 15.248 5.40231 14 5.40386ZM10.9082 13.4779C10.4993 13.4782 10.1069 13.3147 9.8174 13.0227C9.5279 12.7307 9.36507 12.3341 9.36428 11.9206C9.36454 11.5066 9.52693 11.1093 9.81643 10.8165C10.1059 10.5238 10.4988 10.3596 10.9082 10.3593C11.3176 10.3596 11.7095 10.5238 11.999 10.8165C12.2885 11.1093 12.4519 11.5066 12.4522 11.9206C12.4514 12.3341 12.2885 12.7307 11.999 13.0227C11.7095 13.3147 11.3171 13.4782 10.9082 13.4779Z"
        fill="currentColor"
      />
    </svg>
  );
}

function ChatIcon(props) {
  return (
    <svg width="28" height="29" viewBox="0 0 28 29" fill="none" {...props}>
      <path
        d="M14.0005 28.6813C10.2885 28.6774 6.72936 27.2177 4.10463 24.6219C1.47989 22.0261 0.0039707 18.5062 0 14.8352C0.00449896 11.1643 1.48098 7.64506 4.1056 5.04937C6.73023 2.45367 10.2887 0.993463 14.0005 0.989014C17.7122 0.993463 21.2707 2.45367 23.8953 5.04937C26.5199 7.64506 27.9964 11.1643 28.0009 14.8352C27.997 18.5062 26.521 22.0261 23.8963 24.6219C21.2716 27.2177 17.7124 28.6774 14.0005 28.6813ZM9.87337 21.7071C10.0807 21.7075 10.2856 21.7472 10.4779 21.8239C11.5882 22.3245 12.7818 22.6212 13.9995 22.6999C15.0863 22.6985 16.1614 22.477 17.1588 22.0499C18.1562 21.6229 19.0547 20.9996 19.7995 20.2168C20.5414 19.4317 21.1139 18.5045 21.4812 17.4931C21.8485 16.4818 22.0026 15.4074 21.9353 14.3349C21.8044 12.3425 20.9134 10.4738 19.442 9.10682C17.9707 7.7398 16.029 6.9762 14.0102 6.97137C13.9102 6.97137 13.8255 6.97137 13.7475 6.97137C11.6798 7.02616 9.71592 7.87999 8.27664 9.34925C6.83736 10.8185 6.03692 12.7866 6.04707 14.8323C6.0854 15.8439 6.27755 16.8441 6.61643 17.7993C6.69709 18.0367 6.71695 18.2902 6.67502 18.5372L6.22677 21.3478C6.20724 21.4724 6.21906 21.6001 6.25997 21.7196C6.30088 21.8391 6.37003 21.9472 6.46213 22.0345C6.60703 22.1722 6.80025 22.2489 7.00121 22.2489C7.0574 22.2486 7.11339 22.2418 7.16821 22.2296L9.52864 21.7351C9.64231 21.7136 9.75767 21.7047 9.87337 21.7071ZM17.274 15.9343C16.9802 15.9345 16.6979 15.8187 16.4898 15.6136C16.2817 15.4085 16.1644 15.1305 16.1636 14.84C16.1634 14.5494 16.2795 14.2712 16.4869 14.0654C16.6942 13.8596 16.9753 13.7426 17.2691 13.7418C17.5634 13.7424 17.8462 13.8587 18.0543 14.0644C18.2624 14.2702 18.379 14.549 18.3795 14.84C18.3792 15.1297 18.2632 15.4076 18.0563 15.6127C17.8493 15.8177 17.5689 15.9335 17.276 15.9343H17.274ZM13.9985 15.9343C13.7043 15.9338 13.4224 15.8175 13.2143 15.6117C13.0062 15.4059 12.8886 15.1271 12.8881 14.8361C12.8881 14.5471 13.0043 14.2694 13.2104 14.0644C13.4165 13.8595 13.6964 13.7434 13.9887 13.7418H13.9956C14.2888 13.7421 14.5695 13.8574 14.7769 14.0625C14.9842 14.2676 15.1008 14.5461 15.1011 14.8361C15.1014 15.1258 14.9861 15.4041 14.7798 15.6098C14.5735 15.8154 14.2934 15.9322 14.0005 15.9343H13.9985ZM10.723 15.9343C10.4288 15.9338 10.1469 15.8175 9.9388 15.6117C9.73075 15.4059 9.61413 15.1271 9.6136 14.8361C9.6149 14.5474 9.73101 14.2711 9.93685 14.0664C10.1427 13.8617 10.4214 13.7447 10.7132 13.7418H10.7201C11.0139 13.7416 11.2962 13.8574 11.5043 14.0625C11.7124 14.2676 11.8297 14.5456 11.8305 14.8361C11.8292 15.128 11.7116 15.4078 11.5033 15.6146C11.2958 15.8171 11.0164 15.9319 10.725 15.9343H10.723Z"
        fill="currentColor"
      />
    </svg>
  );
}

function GuildIcon(props) {
  return (
    <svg width="28" height="29" viewBox="0 0 28 29" fill="none" {...props}>
      <path
        d="M14 28.3146C10.2882 28.3106 6.72914 26.8181 4.10449 24.164C1.47984 21.5099 0.00397056 17.9108 0 14.1573C0.00449881 10.4039 1.48093 6.80562 4.10547 4.1516C6.73 1.49757 10.2884 0.00454936 14 0C17.7117 0.00454936 21.27 1.49757 23.8945 4.1516C26.5191 6.80562 27.9955 10.4039 28 14.1573C27.996 17.9108 26.5202 21.5099 23.8955 24.164C21.2709 26.8181 17.7118 28.3106 14 28.3146ZM14 19.6865L16.5996 20.7995C16.8091 20.8931 17.0356 20.9409 17.2646 20.9407H17.2871C17.5232 20.94 17.7564 20.8904 17.9727 20.7945C18.1889 20.6987 18.3835 20.5589 18.5439 20.3837C18.7055 20.2092 18.8305 20.0024 18.9102 19.7774C18.9898 19.5523 19.0223 19.3138 19.0068 19.0752L18.8066 16.004L20.6572 13.6655C20.8379 13.4375 20.9586 13.1671 21.0088 12.8794C21.0589 12.5917 21.037 12.296 20.9443 12.0193C20.8532 11.7429 20.695 11.4941 20.4844 11.2954C20.2737 11.0967 20.0173 10.9544 19.7383 10.8816L16.999 10.1568L15.499 7.58822L15.4766 7.55464C15.3147 7.31175 15.0966 7.11332 14.8408 6.97595C14.585 6.83857 14.2994 6.76715 14.0098 6.76758C13.7201 6.76715 13.4345 6.83857 13.1787 6.97595C12.9229 7.11332 12.7049 7.31175 12.543 7.55464L11.0137 10.1568L8.2793 10.8777C7.99859 10.9498 7.73973 11.0923 7.52832 11.2925C7.31691 11.4926 7.15986 11.7437 7.07031 12.0223C6.97768 12.2987 6.95515 12.5951 7.00586 12.8824C7.05656 13.1697 7.17889 13.4386 7.36035 13.6655L9.20996 16.005L9.00977 19.0723C8.99338 19.3111 9.02529 19.5504 9.10352 19.7764C9.18174 20.0024 9.30472 20.2103 9.46484 20.3867C9.62714 20.5615 9.82346 20.7002 10.041 20.7955C10.2586 20.8908 10.4934 20.9405 10.7305 20.9407C10.9647 20.9411 11.1961 20.8933 11.4111 20.7995L14.0059 19.6865H14Z"
        fill="currentColor"
      />
    </svg>
  );
}

function RankIcon(props) {
  return (
    <svg width="29" height="29" viewBox="0 0 29 29" fill="none" {...props}>
      <path
        d="M14.1394 28.3153C11.3704 28.3155 8.66341 27.4853 6.36093 25.9297C4.05846 24.3741 2.26389 22.163 1.20418 19.5759C0.144467 16.9889 -0.132781 14.1422 0.407495 11.3958C0.947772 8.64941 2.28131 6.12673 4.23944 4.14679C6.86509 1.49164 10.4262 0 14.1394 0C17.8527 0 21.4138 1.49164 24.0394 4.14679C26.6651 6.80193 28.1402 10.4031 28.1402 14.158C28.1402 17.913 26.6651 21.5141 24.0394 24.1693C22.7424 25.488 21.1995 26.5335 19.5001 27.2451C17.8008 27.9568 15.9787 28.3206 14.1394 28.3153ZM6.80044 11.2588C6.65405 11.2626 6.5106 11.3012 6.3817 11.3715C6.25279 11.4418 6.14205 11.5417 6.05844 11.6633C5.96919 11.7913 5.90734 11.9368 5.87686 12.0904C5.84639 12.244 5.84795 12.4023 5.88144 12.5552L7.10944 18.6499C7.14363 18.8743 7.25392 19.0796 7.42141 19.2307C7.5889 19.3818 7.80316 19.4693 8.02744 19.4781H20.2514C20.4756 19.469 20.6897 19.3816 20.8572 19.2307C21.0248 19.0799 21.1355 18.875 21.1704 18.6509L22.3994 12.5613C22.433 12.4078 22.4345 12.2489 22.4038 12.0948C22.3732 11.9407 22.3111 11.7948 22.2214 11.6663C22.1382 11.5447 22.0276 11.4446 21.8989 11.3743C21.7701 11.304 21.6267 11.2655 21.4804 11.2618C21.3078 11.2633 21.1395 11.3172 20.9974 11.4166L18.5524 13.0649C18.4098 13.1624 18.2417 13.2148 18.0694 13.2156C17.899 13.2117 17.7329 13.1605 17.5894 13.0676C17.4458 12.9747 17.3303 12.8436 17.2554 12.6887L14.9554 8.23926C14.8826 8.08319 14.7675 7.95126 14.6233 7.85886C14.4792 7.76646 14.3121 7.7174 14.1414 7.7174C13.9708 7.7174 13.8037 7.76646 13.6595 7.85886C13.5154 7.95126 13.4002 8.08319 13.3274 8.23926L11.0274 12.6887C10.9522 12.8436 10.8365 12.9747 10.6928 13.0677C10.5492 13.1608 10.383 13.2122 10.2124 13.2166C10.0401 13.2155 9.87204 13.1627 9.72944 13.0649L7.28344 11.4166C7.14181 11.316 6.97347 11.2611 6.80044 11.2588Z"
        fill="currentColor"
      />
    </svg>
  );
}

function AchievementIcon(props) {
  return (
    <svg width="28" height="29" viewBox="0 0 28 29" fill="none" {...props}>
      <path
        d="M14 28.3147C10.2879 28.3106 6.72838 26.8504 4.10357 24.2546C1.47877 21.6588 0.00295815 18.1397 0 14.4277C0.00395588 10.7158 1.48045 7.19764 4.10515 4.60209C6.72985 2.00654 10.2887 0.546726 14 0.542969C17.7113 0.546726 21.2702 2.00654 23.8949 4.60209C26.5195 7.19764 27.9961 10.7158 28 14.4277C27.997 18.1397 26.5212 21.6588 23.8964 24.2546C21.2716 26.8504 17.7121 28.3106 14 28.3147ZM14 5.54297C11.5717 5.54297 9.2427 6.50747 7.52208 8.22809C5.80146 9.94871 4.83696 12.2777 4.83696 14.706C4.83696 17.1343 5.80146 19.4633 7.52208 21.1839C9.2427 22.9045 11.5717 23.869 14 23.869C16.4283 23.869 18.7573 22.9045 20.4779 21.1839C22.1985 19.4633 23.163 17.1343 23.163 14.706C23.163 12.2777 22.1985 9.94871 20.4779 8.22809C18.7573 6.50747 16.4283 5.54297 14 5.54297ZM14 10.5447L15.7083 13.9863L19.5217 14.5391L16.7608 17.236L17.4167 21.0353L14 19.2412L10.5833 21.0353L11.2392 17.236L8.47833 14.5391L12.2917 13.9863L14 10.5447Z"
        fill="currentColor"
      />
    </svg>
  );
}

export default function NavBar() {
  const location = useLocation();
  const navigate = useNavigate();
  const [guildId, setGuildId] = useState(null);

  const navItems = [
    { label: "Acts", icon: ActIcon, path: "/acts" },
    { label: "Chat", icon: ChatIcon, path: "/chat", isGuildChat: true },
    { label: "Guilds", icon: GuildIcon, path: "/guilds" },
    { label: "Rank", icon: RankIcon, path: "/rank" },
  ];

  useEffect(() => {
    const fetchUserGuild = async () => {
      try {
        const response = await api.get("/guild/get-my-guild");
        if (response.data?.id) {
          setGuildId(response.data.id);
        }
      } catch (err) {
        console.error("Error fetching guild for chat:", err);
      }
    };

    fetchUserGuild();
  }, []);

  const handlePlayClick = () => {
    navigate("/create-act");
  };

  const handleNavClick = (item) => {
    if (item.isGuildChat && guildId) {
      navigate(`/guilds/${guildId}`);
    } else if (item.isGuildChat) {
      // Если нет гильдии, можно перенаправить на страницу гильдий
      navigate("/guilds");
    } else {
      navigate(item.path);
    }
  };

  return (
    <div style={{ position: "relative", width: "100%" }}>
      <div
        className={styles.playBtn + " " + styles.playBtnFloating}
        onClick={() => {
          handlePlayClick();
        }}
      >
        <img src="/icons/NavBar/playBtn.svg" alt="playBtn" />
      </div>
      <div className={styles.navBar}>
        <div className={styles.nav}>
          {navItems.map((item) => {
            const isActive = location.pathname.startsWith(item.path);
            const Icon = item.icon;
            return (
              <div
                key={item.label}
                className={
                  styles.item +
                  " " +
                  (isActive ? styles.active : styles.inactive)
                }
                onClick={() => handleNavClick(item)}
                style={{
                  cursor: "pointer",
                }}
              >
                <Icon style={{ fill: isActive ? "#fff" : "#bdbdbd" }} />
                <p style={{ color: isActive ? "#fff" : "#bdbdbd" }}>
                  {item.label}
                </p>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}
